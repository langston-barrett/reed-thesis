%% math symbols, notation, etc
\usepackage{amssymb}       % math characters
\usepackage{mathtools}     % improvement on amsmath

\usepackage{unicode-math}         % use OTF math fonts
\AtBeginDocument{\let\epsilon\varepsilon}
\setmathfont[math-style=ISO]{Tex Gyre Schola Math}
\setmathfont[range=\mathup]{Tex Gyre Schola Math}
\setmathfont[range=\mathcal]{Latin Modern Math}
\setoperatorfont\mathup % operators should be set in math font

% For some reason, Schola and Latin Modern are missing setminus
\AtBeginDocument{\let\setminus\minus}
% \setmathfont[range=\setminus]{Asana Math}

% fix xmapsto. only works with text above.
% https://github.com/wspr/unicode-math/issues/197
\ExplSyntaxOn
\RenewDocumentCommand \xmapsto { m } {
  \mathrel {
    \exp_after:wN \Uoverdelimiter \cs:w sym \__um_symfont_tl \cs_end: "21A6 {
      \mkern 5mu \scan_stop: #1 \mkern 5mu \scan_stop:
    }
  }
}
\ExplSyntaxOff

% general stuff
\newcommand{\units}[1]{\;\mathrm{#1}}
\newcommand{\dd}{\,\mathrm{d}}
\newcommand{\ov}{\overline}
\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\braces}[1]{\left\{#1\right\}}
\newcommand{\brackets}[1]{\left[#1\right]}
\newcommand{\ceiling}[1]{\left\lceil{} #1 \right\rceil}
\newcommand{\floor}[1]{\left\lfloor{} #1 \right\rfloor}
\newcommand{\abs}[1]{\left| #1 \right|}
\newcommand{\e}[1]{\cdot 10^{#1}}
% \newcommand{\emf}{\mathcal{E}}
\newcommand{\contradiction}{\Rightarrow\Leftarrow}
\newcommand{\inv}[1]{\frac{1}{#1}}
\newcommand{\tif}{\text{ if }}
\newcommand{\totherwise}{\text{ otherwise }}
% \newcommand{\mydef}{\textbf{Definition:}}
% complex numbers
\renewcommand{\Im}{\operatorname{Im}}
\renewcommand{\Re}{\operatorname{Re}}

% operators/functions
\DeclareMathOperator{\ord}{ord}
% \DeclareMathOperator{\image}{image}
\DeclareMathOperator{\Int}{Int}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Lim}{Lim}
\DeclareMathOperator{\Bd}{Bd}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\proj}{proj}
\DeclareMathOperator{\xor}{xor}
\DeclareMathOperator{\spanf}{span}
\DeclareMathOperator{\id}{id}
% linear
\DeclareMathOperator{\col}{Col}
\DeclareMathOperator{\row}{Row}
\DeclareMathOperator{\nul}{Nul}
\DeclareMathOperator{\rank}{rank}

% set theory
\newcommand{\xlongmapsto}[1]{\xmapsto{\,\,\, #1\,\,\,}}
\newcommand{\xlongrightarrow}[1]{\xrightarrow{\,\,\, #1\,\,\,}}
\newcommand{\union}{\mathop{\bigcup}}
\newcommand{\disunion}{\mathop{\dot\bigcup}}
\newcommand{\intersection}{\mathop{\bigcap}}
\newcommand{\powerset}{\mathcal{P}}

% analysis & calculus
\usepackage{esint} % \oiint, etc
\newcommand{\evalat}[2]{{\bigg|_{#1}^{#2}}}
\newcommand{\ext}[1]{{#1}^{ext}}  % extension of function
\DeclareMathOperator{\determinant}{det}
\DeclareMathOperator{\oball}{B}
\DeclareMathOperator{\cball}{\ov{B}}
\DeclareMathOperator{\sphere}{S}
\DeclareMathOperator{\divergence}{div}
\DeclareMathOperator{\curl}{curl}

% vectors
\newcommand{\ihat}{\hat{\imath}}
\newcommand{\jhat}{\hat{\jmath}}
\newcommand{\khat}{\hat{k}}
\newcommand{\lvec}[1]{\overrightarrow{#1}}
\newcommand{\len}[1]{\left\| #1 \right\|}

% topology
\newcommand{\RP}{\ensuremath{\R\hspace{-0.07em}\mathrm{P}}}

% categories
\DeclareMathOperator{\Set}{\mathbf{Set}}           % sets
\DeclareMathOperator{\Cat}{\mathbf{Cat}}           % small categories
\DeclareMathOperator{\Grpd}{\mathbf{Grpd}}         % small groupoids
\DeclareMathOperator{\Mon}{\mathbf{Mon}}           % monoids
\DeclareMathOperator{\Grp}{\mathbf{Grp}}           % groups
\DeclareMathOperator{\AbGrp}{\mathbf{AbGrp}}       % abelian groups
\DeclareMathOperator{\Top}{\mathbf{Top}}           % topological spaces
\DeclareMathOperator{\Man}{\mathbf{Man}}           % topological manifolds
\DeclareMathOperator{\Metric}{\mathbf{Metric}}     % metric spaces
\DeclareMathOperator{\Vect}{\mathbf{Vect}}         % vector spaces

% number theory
\newcommand{\modulus}[1]{\; \left(\mathrm{mod}\; #1\right)}
\newcommand{\crash}[2]{\left(\frac{#1}{#2}\right)}
\newcommand{\QED}{\begin{flushright}QED\end{flushright}}

% make letters in different fonts (bold, blackboard, caligraphic, fraktur)
% https://tex.stackexchange.com/questions/156196/newcommand-with-variable-name
\newcommand{\mkltr}[1]{%
    \expandafter\newcommand\csname bf#1\endcsname{\ensuremath{\mathbf #1}}
    \expandafter\newcommand\csname bb#1\endcsname{\ensuremath{\mathbb #1}}
    \expandafter\newcommand\csname ca#1\endcsname{\ensuremath{\mathcal #1}}
    \expandafter\newcommand\csname fr#1\endcsname{\ensuremath{\mathfrak #1}}
}%
\mkltr A \mkltr B \mkltr C \mkltr D \mkltr E \mkltr F \mkltr G \mkltr H
\mkltr I \mkltr J \mkltr K \mkltr L \mkltr M \mkltr N \mkltr O \mkltr P
\mkltr Q \mkltr R \mkltr S \mkltr T \mkltr U \mkltr V \mkltr W \mkltr X
\mkltr Y \mkltr Z

\newcommand{\zn}{\mathbf{Z}_n}
\newcommand{\zp}{\mathbf{Z}_p}
\newcommand{\N}{\ensuremath{\mathbf{N}}}
\newcommand{\Z}{\ensuremath{\mathbf{Z}}}
\newcommand{\Q}{\ensuremath{\mathbf{Q}}}
\newcommand{\R}{\ensuremath{\mathbf{R}}}
\newcommand{\C}{\ensuremath{\mathbf{C}}}

% algebra
\newcommand{\quotient}[2]{{\raisebox{.2em}{$#1$}\left/\raisebox{-.2em}{$#2$}\right.}}
\newcommand{\GL}{\mathrm{GL}}     % general linear group
\newcommand{\SL}{\mathrm{SL}}     % special linear group
\renewcommand{\S}{\mathfrak{S}}   % symmetric group
\DeclareMathOperator{\ann}{ann}   % the annihilator of a submodule
\DeclareMathOperator{\Obj}{Obj}   % objects of a category
\DeclareMathOperator{\Hom}{Hom}   % homomorphisms between modules
\DeclareMathOperator{\Mor}{Mor}   % categorical morphisms
\DeclareMathOperator{\characteristic}{char} % ring characteristic
\DeclareMathOperator{\Tor}{Tor}   % torsion elements
\DeclareMathOperator{\Stab}{Stab} % stabilizer
\DeclareMathOperator{\Orb}{Orb}   % orbit
\DeclareMathOperator{\Aut}{Aut}   % automorphisms
\DeclareMathOperator{\Alt}{Alt}   % alternating group
\DeclareMathOperator{\End}{End}   % endomorphisms
\DeclareMathOperator{\Mat}{Mat}   % matrix ring
\DeclareMathOperator{\Tr}{Trace}  % trace of a matrix
\DeclareMathOperator{\im}{im}     % image
\newcommand{\ab}{\mathbf{ab}}     % abelianization

% statistics
\DeclareMathOperator{\Var}{Var}

% nicer empty set
\let\oldemptyset\emptyset{}
\let\emptyset\varnothing{}